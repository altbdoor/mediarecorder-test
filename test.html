<!doctype html>
<script>
  var MEDIATYPES = ["audio", "video"];
  var CONTAINERS = [
    "webm",
    "ogg",
    "mp3",
    "mp4",
    "mpeg",
    "aac",
    "flac",
    "wav",
  ];
  var CODECS = [
    "vp9",
    "vp9.0",
    "vp8",
    "vp8.0",
    "avc1",
    "av1",
    "h265",
    "h.265",
    "h264",
    "h.264",
    "opus",
    "vorbis",
    "pcm",
    "aac",
    "mpeg",
    "mp4a",
  ];

  var formats = [
    ...new Set(
      CONTAINERS.flatMap((ext) =>
        MEDIATYPES.flatMap((mediaType) => [`${mediaType}/${ext}`]),
      ),
    ),
    ...new Set(
      CONTAINERS.flatMap((ext) =>
        CODECS.flatMap((codec) =>
          MEDIATYPES.flatMap((mediaType) => [
            `${mediaType}/${ext};codecs=${codec}`,
          ]),
        ),
      ),
    ),
  ];

  var formatMap = {
    _meta: {
      userAgent: navigator.userAgent,
    },
  };

  formats.forEach(function (format) {
    formatMap[format] = MediaRecorder.isTypeSupported(format);
  });
  document.write("<pre>" + JSON.stringify(formatMap, null, 4) + "</pre>");
</script>
